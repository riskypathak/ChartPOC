
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Epoch Charts - Proof Of Concept</title>
    <meta name="viewport" content="width=800">

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/epoch.css">

    <script src="js/papaparse.js"></script>
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/d3.js"></script>
    <script src="js/epoch.js"></script>
    <script src="js/data.js"></script>

    <script>
        var csvData;

        function handleFileSelect(evt) {
            var file = evt.target.files[0];

            Papa.parse(file, {
                header: true,
                dynamicTyping: true,
                complete: function (results) {
                    csvData = results;
                    process();
                }
            });
        }


        var index = 0;
        function process() {
            var history = [];

            history.push({ values: [] });

            for (i = 0; i < 60; i++) {
                history[0].values.push(csvData.data[i]);
            }
            index = i;

            var chart = $('#real-time-line').epoch({
                type: 'time.line',
                data: history,
                axes: ['left', 'bottom', 'right'],
                fps: 29,
                tickFormats: { time: function (d) { return "d"; } },
                ticks: { time: 20, right: 10, left: 10 }
            });

            setInterval(function () { chart.push(next()); }, 1000);
            chart.push(next());
        }

        function next() {
            if (index < csvData.data.length) {
                var entry = [];
                entry.push(csvData.data[index]);
                return entry;
            }

            return;
        }

        $(document).ready(function () {
            $("#csv-file").change(handleFileSelect);
        });
    </script>
</head>
<body>

    <div class="container">
        <div class="row">
            <h3 id="line">Select File</h3>
            <input type="file" id="csv-file" name="files" />
            <div id="content" class="col-md-10">
            </div>
        </div>
        <div class="row">
            <div id="content" class="col-md-10">

                <h3 id="line">Chart</h3>

                <div id="real-time-line" class="epoch" style="height: 200px"></div>
            </div>
        </div>
        <div class="row">
            <div id="content" class="col-md-10">
                <h3 id="line">Video</h3>
                <video id="video-active"
                       class="video-active"
                       width="640"
                       height="390"
                       controls="controls">
                    <source src="movie.mp4" type="video/mp4">
                </video>
                <div id="current">0:00</div>
                <div id="duration">0:00</div>

                <script>
                    $(document).ready(function () {
                        $("#video-active").on(
                          "pause",
                          function (event) {
                              //this.pause();
                              console.error(this.currentTime);
                              //onTrackedVideoFrame(this.currentTime, this.duration);
                              //this.play();
                          });
                    });

                    function onTrackedVideoFrame(currentTime, duration) {
                        $("#current").text(currentTime);
                        $("#duration").text(duration);
                    }
                </script>
            </div>
        </div>
    </div>
</body>
</html>
