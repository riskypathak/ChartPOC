
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Epoch Charts - Proof Of Concept</title>
    <meta name="viewport" content="width=800">

    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/epoch.css">

    <script src="/js/papaparse.js"></script>
    <script src="/js/jquery.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/d3.js"></script>
    <script src="/js/epoch.js"></script>
    <script src="/js/data.js"></script>

    <script>
        var csvData;

        function handleFileSelect(evt) {
            var file = evt.target.files[0];

            Papa.parse(file, {
                header: true,
                dynamicTyping: true,
                complete: function (results) {
                    csvData = results;
                    process();
                }
            });
        }


        var index = 0;
        function process() {
            var history = [];


            history.push({ values: [] });

            for (i = 0; i < 60; i++) {
                history[0].values.push(csvData.data[i]);
            }
            index = i;

            var chart = $('#real-time-line').epoch({
                type: 'time.line',
                data: history,
                axes: ['left', 'bottom', 'right'],
                ticks: { time: 10, right: 5, left: 5 }
            });

            setInterval(function () { chart.push(next()); }, 1000);
            chart.push(next());
        }

        function next() {
            if (index < csvData.data.length) {
                var entry = [];
                entry.push(csvData.data[index]);
                return entry;
            }

            return;
        }

        $(document).ready(function () {
            $("#csv-file").change(handleFileSelect);
        });
    </script>
</head>
<body>

    <div class="container">
        <div class="row">
            <div id="content" class="col-md-10">
                <input type="file" id="csv-file" name="files" />

                <h3 id="line">Chart</h3>

                <div id="real-time-line" class="epoch" style="height: 200px"></div>
            </div>
        </div>
    </div>
</body>
</html>
